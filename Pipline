conda activate anvio-6.2
###anvio only recognize suffix .fa and .fasta file 
rename 's/\.1_(.+)fna$/.fasta/' ./*
for i in *fasta;anvi-script-FASTA-to-contigs-db $i
###phylogenetic analysis
anvi-gen-genomes-storage -e external_genomes.txt -o Nitrospira-GENOMES.db
-------------------------------------
name	contigs_db_path
GCA_003152135	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_003152135.db
GCA_003135435	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_003135435.db
GCA_002869885	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_002869885.db
GCA_002869925	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_002869925.db
GCA_002331625	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_002331625.db
GCA_002483475	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_002483475.db
GCA_002083355	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_002083355.db
GCA_002420045	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_002420045.db
GCA_003529185	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_003529185.db
GCA_002420115	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_002420115.db
GCA_002254365	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_002254365.db
GCA_001458735	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_001458735.db
GCA_002083365	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_002083365.db
GCA_001464735	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_001464735.db
GCA_001458775	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_001458775.db
GCA_014058405	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_014058405.db
GCA_002331335	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_002331335.db
GCA_002451055	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_002451055.db
GCA_001458695	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_001458695.db
GCA_002083405	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_002083405.db
GCA_002083565	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/GCA_002083565.db
S9_bin_98	/home/disk2/zry/JR/coassembly/Nitrospira/phylogenetic/S9_bin_98.db
-------------------------------------
anvi-get-sequences-for-hmm-hits --external-genomes external_genomes.txt --hmm-source Bacteria_71 -o concatenated-proteins.fa --return-best-hit --get-aa-sequences --concatenate
anvi-gen-phylogenomic-tree -f concatenated-proteins.fa -o phylogenomic-tree.txt
anvi-interactive -p Nitrospira-GENOMES.db -t phylogenomic-tree.txt --title "Nitrospira Phylogenetic Tree" --manual 

nohup raxmlHPC-PTHREADS-AVX2 -f a -x 12345 -p 12345 -# 1000 -m PROTGAMMAWAG -s concatenated-proteins.fa -n Nitrospira-raxml-1 -T 20 &

pangenome analysis
for i in *db;anvi-run-ncbi-cogs -c $i --sensitive --search-with diamond -T 20
anvi-gen-genomes-storage -e COB_genomes.txt -o COB-GENOMES.db
anvi-pan-genome -g COB-GENOMES.db --project-name "COB-PAN" --output-dir COB-PAN --num-threads 20 --minbit 0.5 --mcl-inflation 10 --enforce-hierarchical-clustering
anvi-display-pan -g COB-GENOMES.db -p COB-PAN/COB-PAN-PAN.db --title "COB Pan" 


事情要接着S9——bin98来说，因为bin98在系统发育树和ANI上基本确定是和kreftii近似，但是amoCAB的cluster拼接不完整。
下载了kreftii’的全基因组，以它为ref，创建database
makeblastdb -in kreftii.fasta -dbtype nucl -parse_seqids
通过blastn提取样本9质控好的短序列中和kreftii相似度在95%的短序列，
blastn -db kreftii.fasta -query /home/disk2/zry/JR/Trimmomatic_out/9/read.fas -out results.out -outfmt 6 -evalue 0.00001 -perc_identity 95 -num_threads 30
在通过这些序列的名称，借助bbmap tools中的filterbyname.sh成对的提取hit序列
/home/server/bbmap/filterbyname.sh in=/home/disk2/zry/JR/Trimmomatic_out/9/forward.clean.paired.fq in2=/home/disk2/zry/JR/Trimmomatic_out/9/reverse.clean.paired.fq out=read_1.fq out2=read_2.fq names=names.txt include=t
 
再用spades对这些提取的序列进行meta模式下的assembly拼接，
/home/server/SPAdes-3.12.0-Linux/bin/spades.py -1 read_1.fq -2 read_2.fq --meta -o spades.out -t 30 -k 21,33,55,75,101,125
 
最终我们将该bin98 的amoCAB cluster拼接完整。
